groups:
  - name: rules
    rules:
    - alert: CPUMedium
      expr: avg by (space) (cpu{space=~"teaching-vacancies-production"}) > 50
      labels:
        severity: medium
      annotations:
        summary: CPU usage medium
    - alert: CPUHigh
      expr: avg by (space) (cpu{space=~"teaching-vacancies-production"}) > 80
      labels:
        severity: high
      annotations:
        summary: CPU usage high
    - alert: InstanceDown
      expr: up == 0
      for: 1m
      labels:
        severity: high
      annotations:
        summary: Instance down
    - alert: DBConnectionsLow
      expr: connections{service="teaching-vacancies-postgres-production"} < 8
      labels:
        severity: low
      annotations:
        summary: DB connections below 8
    - alert: DBConnectionsHigh
      expr: connections{service="teaching-vacancies-postgres-production"} > 22
      labels:
        severity: medium
      annotations:
        summary: DB connections above 22
    - alert: DBConnectionsNone
      expr: connections{service="teaching-vacancies-postgres-production"} = 0
      labels:
        severity: high
      annotations:
        summary: No DB Connections
    - alert: DiskUtilizationHigh
      expr: avg by (space) (disk_utilization{space=~"teaching-vacancies-production"}) > 50
      labels:
        severity: medium
      annotations:
        summary: Disk Utilization High
    - alert: WorkerMemoryUtilizationHigh
      expr: avg by (app) (memory_utilization{app=~"teaching-vacancies-worker-production"}) > 70
      labels:
        severity: page
      annotations:
        summary: Worker Memory Utilization High
    - alert: AppMemoryUtilizationHigh
      expr: avg by (app) (memory_utilization{app=~"teaching-vacancies-production"}) > 70
      labels:
        severity: high
      annotations:
        summary: App Memory Utilization High
    - alert: CrashedProductionApps
      expr: sum by (space) (crash{space=~"teaching-vacancies-production"}) > 0
      labels:
        severity: high
      annotations:
        summary: Crashed Production Apps non-zero
    - alert: CrashedStagingApps
      expr: sum by (space) (crash{space=~"teaching-vacancies-staging"}) > 0
      labels:
        severity: high
      annotations:
        summary: Crashed Staging Apps non-zero
    - alert: CrashedDevApps
      expr: sum_over_time(crash{space=~"teaching-vacancies-dev"}[5m]) > 0
      labels:
        severity: low
      annotations:
        summary: Crashed Dev Apps non-zero
    - alert: TooManyProdApps
      expr: count(memory_utilization{space=~"teaching-vacancies-production"}) > 6
      labels:
        severity: medium
      annotations:
        summary: More than 6 apps in Production
    - alert: TooManyStagingApps
      expr: count(memory_utilization{space=~"teaching-vacancies-staging"}) > 4
      labels:
        severity: low
      annotations:
        summary: More than 4 apps in Staging
    - alert: TooManyDevApps
      expr: count(memory_utilization{space=~"teaching-vacancies-dev"}) > 4
      labels:
        severity: low
      annotations:
        summary: More than 4 apps in Dev
