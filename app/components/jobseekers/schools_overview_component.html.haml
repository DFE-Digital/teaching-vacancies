%section#school-overview.govuk-tabs__panel.no-border-override
  %h3.govuk-heading-l
    = t('schools.schools_overview')

  %table.govuk-table
    %tbody.govuk-table__body
      %tr.govuk-table__row
        %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
          = t('school_groups.type')
        %td.govuk-table__cell
          = @vacancy.parent_organisation.group_type
      - if @vacancy.parent_organisation.website.present? || @vacancy.parent_organisation.url.present?
        %tr.govuk-table__row
          %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
            = t('school_groups.website')
          %td.govuk-table__cell
            = link_to(t('jobs.website_link_text', organisation_name: @vacancy.parent_organisation.name), @vacancy.parent_organisation.website.presence || @vacancy.parent_organisation.url, class: 'govuk-link wordwrap', target: '_blank')
      - if @vacancy.contact_email.present?
        %tr.govuk-table__row
          %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
            = t('jobs.contact_email')
          %td.govuk-table__cell
            = mail_to @vacancy.contact_email, @vacancy.contact_email, class: 'govuk-link link-wrap', subject: t('jobs.contact_email_subject', job: @vacancy.job_title), body: t('jobs.contact_email_body', url: job_url(@vacancy))

  - if @vacancy.about_school.present?
    %h4.govuk-heading-s
      = t('schools.about_schools')
    = @vacancy.about_school

  %h4.govuk-heading-s{ class: "govuk-!-margin-bottom-0" }
    = t('schools.school_details')

  #accordion-default.govuk-accordion{ data: { module: "govuk-accordion" } }
    - @vacancy.organisations.each_with_index do |organisation, index|
      .govuk-accordion__section
        .govuk-accordion__section-header
          %h3.govuk-accordion__section-heading
            %span.govuk-accordion__section-button{ id: "accordion-default-heading-#{index}"}
              = organisation.name
        .govuk-accordion__section-content{ id: "accordion-default-content-#{index}", aria: { labelledby: "accordion-default-heading-#{index}" } }
          %table.govuk-table
            %tbody.govuk-table__body
              %tr.govuk-table__row
                %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
                  = t('schools.type')
                %td.govuk-table__cell
                  = organisation_type(organisation: organisation, with_age_range: false)
              %tr.govuk-table__row
                %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
                  = t('schools.phase')
                %td.govuk-table__cell
                  = school_phase(organisation)
              %tr.govuk-table__row
                %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
                  = t('schools.school_size')
                %td.govuk-table__cell
                  = school_size(organisation)
              %tr.govuk-table__row
                %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
                  = t('schools.age_range')
                %td.govuk-table__cell
                  = age_range(organisation)
              %tr.govuk-table__row
                %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
                  = t('schools.ofsted_report')
                - if ofsted_report(organisation).present?
                  %td.govuk-table__cell
                    = link_to(t('schools.view_ofsted_report'), ofsted_report(organisation), class: 'govuk-link wordwrap', target: '_blank')
                - else
                  %td.govuk-table__cell
                    = t('schools.no_information')
              %tr.govuk-table__row
                %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
                  = t('schools.address')
                %td.govuk-table__cell
                  = full_address(organisation)
              - if organisation.website.present? || organisation.url.present?
                %tr.govuk-table__row
                  %td.govuk-table__cell{ class: "govuk-!-font-weight-bold" }
                    = t('schools.website')
                  %td.govuk-table__cell
                    = link_to(t('jobs.website_link_text', organisation_name: organisation.name), organisation.website.presence || organisation.url, class: 'govuk-link link-wrap', target: '_blank')

  - if @vacancy.school_visits.present?
    %h4.govuk-heading-s
      = t('schools.schools_visits')
    = @vacancy.school_visits

  - if @vacancy.organisations.any?(&:geolocation)
    %h4.govuk-heading-s
      = t('schools.school_location.many')
    %div{ id: 'map', role: 'presentation', aria: { hidden: 'true', label: t('schools.map_aria_label') }, data: { schools: schools_map_data } }
    
    = render partial: '/vacancies/schools', formats: [:js]

    %script{async: true, defer: true, src: "https://maps.googleapis.com/maps/api/js?key=#{ENV['GOOGLE_MAPS_API_KEY']}&callback=initMap"}
    
